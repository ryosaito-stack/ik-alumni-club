# IK ALUMNI CGT サポーターズクラブ会員サイト

## 📌 プロジェクト概要（2025-08-18更新）

### プロジェクト名
**IK ALUMNI CGT サポーターズクラブ会員サイト**

### 目的
カラーガードダンスチーム「IK ALUMNI CGT」のサポーターズクラブ会員向けサイト。
会員限定コンテンツや特典を提供し、チームと支援者のつながりを強化する。

### 会員区分
- **プラチナ会員（PLATINUM）** - 最上位会員、全特典利用可能
- **法人会員（BUSINESS）** - 法人サポーター向け
- **個人会員（INDIVIDUAL）** - 個人サポーター向け

---

## Claude Code 初期設定プロンプト
以下の手順で、このプロジェクトにインタラクティブなドキュメント更新システムを導入してください。
1. 既存ドキュメントの探索
まず、プロジェクト内の既存ドキュメントを探索してください：
.cursor/rules/ ディレクトリ内のすべての.mdファイル
docs/ ディレクトリ（存在する場合）
ルートディレクトリの*.mdファイル（README.md、CONTRIBUTING.mdなど）
その他プロジェクト固有のドキュメントディレクトリ
見つかったドキュメントをリストアップし、それぞれの役割を簡潔に説明してください。
2. CLAUDE.mdへの追記
CLAUDE.mdファイルに以下の内容を追記してください。既にCLAUDE.mdが存在する場合は、既存の内容を保持したまま、以下のセクションを追加してください。
## 📚 ドキュメント自動更新システム

このプロジェクトでは、開発中に得られた知識を体系的に管理し、既存ドキュメントに反映させるシステムを採用しています。

### 参照すべきドキュメント

作業開始時に必ず以下のドキュメントを確認してください：

[ここに探索結果に基づいてドキュメントのリストを生成]
例：
- `.cursor/rules/coding-standards.md` - コーディング規約
- `.cursor/rules/architecture.md` - アーキテクチャ設計
- `docs/troubleshooting.md` - トラブルシューティングガイド

### 更新ルール

#### 提案タイミング
以下の状況で、ドキュメント更新を提案してください：

1. **エラーや問題を解決した時**
2. **効率的な実装パターンを発見した時**
3. **新しいAPI/ライブラリの使用方法を確立した時**
4. **既存ドキュメントの情報が古い/不正確だと判明した時**
5. **頻繁に参照される情報を発見した時**
6. **コードレビューの修正を終わらせた時**

#### 提案フォーマット
💡 ドキュメント更新の提案： [状況の説明]
【更新内容】 [具体的な追加/修正内容]
【更新候補】
[ファイルパス1] - [理由]
[ファイルパス2] - [理由]
新規ファイル作成 - [理由]
どこに追加しますか？（番号を選択 or skip）

#### 承認プロセス
1. ユーザーが更新先を選択
2. 実際の更新内容をプレビュー表示
3. ユーザーが最終承認（yes/edit/no）
4. 承認後、ファイルを更新

### 既存ドキュメントとの連携

- 既存の記載形式やスタイルを踏襲すること
- 関連する既存内容がある場合は参照を明記すること
- 日付（YYYY-MM-DD形式）を含めて更新履歴を残すこと

### 重要な制約

1. **ユーザーの承認なしにファイルを更新しない**
2. **既存の内容を削除・変更せず、追加のみ行う**
3. **機密情報（APIキー、パスワード等）は記録しない**
4. **プロジェクトの慣習やスタイルガイドに従う**

### ドキュメントの分割管理

CLAUDE.mdが肥大化することを防ぐため、以下の基準で適切にファイルを分割してください：

- **100行を超えた場合**: 関連する内容を別ファイルに分離することを提案
- **推奨される分割方法**:
  - `.cursor/rules/update-system.md` - 更新システムのルール
  - `.cursor/rules/project-specific.md` - プロジェクト固有の設定
  - `.cursor/rules/references.md` - 参照すべきドキュメントのリスト
- **CLAUDE.mdには概要とリンクのみ残す**: 詳細は個別ファイルへ
3. 推奨ドキュメント構造の提案
既存のドキュメント構造を分析した上で、不足している可能性のあるドキュメントを提案してください：
📁 ドキュメント構造の提案：
現在のプロジェクトに以下のドキュメントを追加することを推奨します：

[探索結果に基づいて、不足しているドキュメントを提案]
例：
1. `.cursor/rules/patterns.md` - 実装パターンとベストプラクティス
   → 効率的なコードパターンを蓄積

2. `.cursor/rules/troubleshooting.md` - トラブルシューティングガイド
   → エラーと解決策を体系化

3. `.cursor/rules/dependencies.md` - 依存関係とAPI使用例
   → 外部ライブラリの使用方法を記録

4. `.cursor/rules/remote-integration.md` - リモートリポジトリ連携
   → Git操作のベストプラクティス、ブランチ戦略、PR/MRテンプレート、CI/CD設定等を記録

これらのファイルを作成しますか？（作成する番号を選択: "1,2" or "all" or "skip"）
選択されたファイルに対して、初期テンプレートを作成してください。
4. 動作確認
設定完了後、以下のメッセージを表示してください：
✅ ドキュメント自動更新システムの設定が完了しました！

【設定内容】
- CLAUDE.mdに運用ルールを追記
- [作成したドキュメントのリスト]

【今後の動作】
1. 作業中に新しい発見があった際、更新提案を行います
2. あなたの承認を得てから、ドキュメントを更新します
3. 既存のドキュメント形式を踏襲し、知識を体系的に蓄積します

動作テストをしますか？（テスト用のエラーを発生させて、提案フローを確認できます）
5. 初期設定の記録
最後に、.cursor/rules/（または適切な場所）にsetup-log.mdを作成し、実行した初期設定を記録してください：
# ドキュメント自動更新システム 設定ログ

## 設定日時
[YYYY-MM-DD HH:MM]

## 実行内容
1. 既存ドキュメントの探索
   - [見つかったファイルのリスト]

2. CLAUDE.md への追記
   - ドキュメント参照リスト
   - 更新ルール
   - 承認プロセス

3. 新規作成したドキュメント
   - [作成したファイルのリスト]

## 備考
[特記事項があれば記載]

以上の手順を実行し、各ステップでユーザーの確認を取りながら進めてください。

## 📚 ドキュメント自動更新システム

このプロジェクトでは、開発中に得られた知識を体系的に管理し、既存ドキュメントに反映させるシステムを採用しています。

### 参照すべきドキュメント

作業開始時に必ず以下のドキュメントを確認してください：

- `CLAUDE.md` - Claude Code初期設定とプロジェクト規約
- `README.md` - プロジェクト概要（更新予定）
- `.cursor/rules/coding-standards.md` - コーディング規約（作成予定）
- `.cursor/rules/architecture.md` - アーキテクチャ設計（作成予定）
- `.cursor/rules/troubleshooting.md` - トラブルシューティングガイド（作成予定）
- `.cursor/rules/patterns.md` - 実装パターンとベストプラクティス（作成予定）

### 更新ルール

#### 提案タイミング
以下の状況で、ドキュメント更新を提案してください：

1. **エラーや問題を解決した時**
2. **効率的な実装パターンを発見した時**
3. **新しいAPI/ライブラリの使用方法を確立した時**
4. **既存ドキュメントの情報が古い/不正確だと判明した時**
5. **頻繁に参照される情報を発見した時**
6. **コードレビューの修正を終わらせた時**

#### 提案フォーマット
```
💡 ドキュメント更新の提案： [状況の説明]
【更新内容】 [具体的な追加/修正内容]
【更新候補】
[ファイルパス1] - [理由]
[ファイルパス2] - [理由]
新規ファイル作成 - [理由]
どこに追加しますか？（番号を選択 or skip）
```

#### 承認プロセス
1. ユーザーが更新先を選択
2. 実際の更新内容をプレビュー表示
3. ユーザーが最終承認（yes/edit/no）
4. 承認後、ファイルを更新

### 既存ドキュメントとの連携

- 既存の記載形式やスタイルを踏襲すること
- 関連する既存内容がある場合は参照を明記すること
- 日付（YYYY-MM-DD形式）を含めて更新履歴を残すこと

### 重要な制約

1. **ユーザーの承認なしにファイルを更新しない**
2. **既存の内容を削除・変更せず、追加のみ行う**
3. **機密情報（APIキー、パスワード等）は記録しない**
4. **プロジェクトの慣習やスタイルガイドに従う**

### ドキュメントの分割管理

CLAUDE.mdが肥大化することを防ぐため、以下の基準で適切にファイルを分割してください：

- **100行を超えた場合**: 関連する内容を別ファイルに分離することを提案
- **推奨される分割方法**:
  - `.cursor/rules/update-system.md` - 更新システムのルール
  - `.cursor/rules/project-specific.md` - プロジェクト固有の設定
  - `.cursor/rules/references.md` - 参照すべきドキュメントのリスト
- **CLAUDE.mdには概要とリンクのみ残す**: 詳細は個別ファイルへ

## プロジェクト固有の設定

### 言語設定
- **すべての回答は日本語で行ってください**
- **コード内のコメントは日本語で記述してください**
- **UIテキストは英語で記述してください**（文字エンコーディング問題を回避）
- **エラーメッセージの説明は日本語で提供してください**

### 文字エンコーディング対策（2025-08-15追加）
- **重要**: VSCodeで文字化けが発生する場合があるため、以下の対策を実施
  - JSX内のテキストは英語表記を使用
  - 日本語はコメントまたは外部ファイルで管理
  - すべてのファイルはUTF-8（BOMなし）で保存
  - 詳細は `.cursor/rules/coding-standards.md` を参照

## 🚀 実装済み機能（2025-08-15更新）

### 完了したタスク
- ✅ **Next.jsプロジェクト初期設定**
  - TypeScript + Tailwind CSS + App Router構成
  - srcディレクトリ構造の調整
  - ESLint設定

- ✅ **Firebase設定ファイル作成**
  - firebase.json（エミュレーター設定）
  - firestore.rules（セキュリティルール）
  - storage.rules（ストレージルール）
  - .env.local（環境変数）

### 作成済みファイル
- `/ik-alumni-club/docs/setup-guide.md` - 初期設定ガイド
- `/ik-alumni-club/firebase.json` - Firebase設定
- `/ik-alumni-club/firestore.rules` - Firestoreルール
- `/ik-alumni-club/storage.rules` - Storageルール
- `/ik-alumni-club/.env.local` - 環境変数

### 設定済みパッケージ
```json
{
  "dependencies": {
    "firebase": "^12.1.0",
    "firebase-admin": "^13.4.0",
    "next": "15.4.6",
    "react": "19.1.0"
  },
  "devDependencies": {
    "firebase-tools": "^14.12.0",
    "ts-node": "^10.9.2"
  }
}
```

- ✅ **基本ディレクトリ構造の構築**（2025-08-15完了）
  - src/lib、components、hooks、types、scripts作成
  - tsconfig.jsonのパスエイリアス設定（@/でsrcディレクトリ参照）

- ✅ **認証システムの基盤実装**（2025-08-15完了）
  - `/src/lib/firebase.ts` - Firebase初期化とエミュレーター接続
  - `/src/types/index.ts` - 型定義（Member、Content、AuthFormData等）
  - `/src/hooks/useAuth.ts` - 認証用カスタムフック（signup、login、logout機能）

### 実装済みコンポーネント
- Firebase初期化モジュール（エミュレーター自動接続対応）
- 認証状態管理フック（会員情報の自動取得）
- エラーメッセージの日本語化

## 🎉 動作確認済み（2025-08-15）

### 環境構築完了
- ✅ Java 17（openjdk 17.0.16）インストール済み
- ✅ Node.js v20.19.4 設定済み
- ✅ Firebase Emulators 正常起動確認
- ✅ Next.js開発サーバー 正常起動確認

### アクセス可能なURL
- **アプリケーション**: http://localhost:3001
- **Firebase Emulator UI**: http://127.0.0.1:4000
  - Authentication Emulator（ポート9099）
  - Firestore Emulator（ポート8081）
  - Storage Emulator（ポート9199）

### 起動コマンド（確定版）
```bash
# ターミナル1: Firebase Emulator（データ永続化対応）
npm run emu

# ターミナル2: Next.js（Node.js v20必須）
nvm use 20 && npm run dev
```

## 📂 データ永続化機能（2025-08-16追加）

### 設定完了内容
- ✅ **自動保存・自動読み込み機能を実装**
  - 起動時: `./emulator-data`フォルダから自動的にデータを読み込み
  - 終了時: `./emulator-data`フォルダに自動的にデータを保存
  - ユーザー登録やFirestoreのデータが再起動後も保持される

### 更新ファイル
- `package.json` - emuコマンドに`--import`と`--export-on-exit`オプションを追加
- `.gitignore` - `/emulator-data`フォルダとFirebaseデバッグログを除外

### 使用方法
```bash
# 初回起動（データなし）
npm run emu

# ユーザー登録やデータ作成を実施

# Ctrl+Cで終了（自動保存される）

# 次回起動時（前回のデータが自動で読み込まれる）
npm run emu
```

## 📚 コンテンツ管理システム（2025-08-16実装）

### 実装済み機能
- ✅ **コンテンツ一覧・詳細ページ**
  - プラン別コンテンツ表示（Individual/Business/Platinum）
  - 階層的アクセス制御（上位プランは下位コンテンツも閲覧可能）
  - 管理者向け全コンテンツ表示

- ✅ **コンテンツシードスクリプト**
  - `npm run seed:contents` で日本語サンプルコンテンツを投入
  - 各プラン用に10件のコンテンツを自動生成

- ✅ **Firestoreヘルパー関数**
  - `lib/firestore.ts` - コンテンツCRUD操作
  - `hooks/useContents.ts` - Reactフック

### 作成ファイル
- `/src/app/(dashboard)/contents/page.tsx` - コンテンツ一覧
- `/src/app/(dashboard)/contents/[id]/page.tsx` - コンテンツ詳細
- `/src/components/ContentCard.tsx` - コンテンツカードコンポーネント
- `/src/lib/firestore.ts` - Firestoreアクセス層
- `/src/hooks/useContents.ts` - コンテンツ取得フック
- `/scripts/seed-contents.ts` - シードデータスクリプト

## 🎨 コード品質改善（2025-08-16実装）

### 言語ファイルの統一
- ✅ **messages.ts の大幅拡充**
  - 30個以上の新規メッセージ追加
  - コンテンツ関連の全テキストを網羅
  - プラン別表示用メッセージ対応

- ✅ **ハードコードの完全除去**
  - 全ページで日本語/英語テキストのハードコードを除去
  - messages.ts参照に統一

### コーディング規約の策定
- ✅ **`.cursor/rules/coding-standards.md` 作成**
  - 言語管理のベストプラクティス
  - デザイントークン使用ガイドライン
  - 新機能実装時のチェックリスト
  - アンチパターンの明確化

## 📊 実装状況と要件定義の対応表（2025-08-18追加）

### ✅ 要件定義通り実装済み
| 機能 | 要件定義での記載 | 実装状況 |
|------|-----------------|----------|
| ダッシュボード | 必須ページ | ✅ 完成済み |
| プロフィールページ | 必須ページ | ✅ 完成済み |
| 会員登録・ログイン | 必須ページ | ✅ 基本機能実装済み |
| お問い合わせページ | 今後必要なページ | ✅ 実装済み |
| 会員区分管理 | 3種類の会員区分 | ✅ PLATINUM/BUSINESS/INDIVIDUAL対応済み |

### 🔴 未実装の必須機能
| 機能 | 要件定義での記載 | 優先度 | 備考 |
|------|-----------------|--------|------|
| コンサート映像ページ | 必須ページ | 高 | YouTube限定公開埋め込み予定 |
| 会報配信ページ | 必須ページ | 高 | PDF/HTML配信機能 |
| 特典一覧ページ | 必須ページ（完成済みと記載） | 高 | 要確認・実装 |
| お知らせ一覧ページ | 必須ページ | 中 | カテゴリ分類機能含む |
| よくある質問（FAQ） | 今後必要なページ | 中 | カテゴリ分類付きQ&A |
| 利用規約/プライバシーポリシー | 今後必要なページ | 中 | 法的文書 |
| 支援者の声 | 今後必要なページ | 低 | 信頼性向上用 |
| イベントスケジュール | 今後必要なページ | 中 | 既存eventsページ流用可能 |
| 会員特典利用ガイド | 今後必要なページ | 中 | 特典の使い方説明 |

### 🔄 要件定義にない実装済みページ
| ページ | 用途 | 今後の扱い |
|--------|------|------------|
| VIDEO一覧・詳細 | 動画コンテンツ | コンサート映像ページに転用予定 |
| BLOG一覧・詳細 | ブログ記事 | 会報やインタビューコンテンツに転用可能 |
| INFORMATION一覧・詳細 | お知らせ | お知らせ一覧ページとして活用 |
| SCHEDULE一覧・詳細 | イベント情報 | イベントスケジュールとして活用 |

## 📄 実装済みページ一覧（2025-08-18更新）

### 公開ページ
- ✅ **ホームページ** (`/`)
  - ヒーローセクション（背景画像、ロゴ、キャッチコピー）
  - INFORMATIONセクション（最新ニュース3件表示）
  - SCHEDULEセクション（今月のイベント表示）
  - VIDEOセクション（カルーセル形式で動画サムネイル表示）
  - BLOGセクション（最新記事3件、会員限定表示）

### 一覧ページ（ViewAll）
- ✅ **INFORMATION一覧** (`/news`)
  - カテゴリフィルター（All/News/Media/Release）
  - ページネーション機能
  - 日付・タイトル・カテゴリ表示
  
- ✅ **SCHEDULE一覧** (`/events`)
  - 月別ナビゲーション
  - カテゴリフィルター（All/Live/Event/Media）
  - 無限スクロール（月ごとの自動読み込み）
  
- ✅ **VIDEO一覧** (`/videos`)
  - カテゴリフィルター（All/MV/Live/Documentary）
  - グリッドレイアウト
  - プレイボタン付きサムネイル
  
- ✅ **BLOG一覧** (`/blog`)
  - カテゴリフィルター（All/Member/Behind/Interview）
  - 著者情報・読了時間表示
  - プレミアムバッジ表示

### 詳細ページ
- ✅ **INFORMATION詳細** (`/news/[id]`)
- ✅ **SCHEDULE詳細** (`/events/[id]`)
- ✅ **VIDEO詳細** (`/videos/[id]`)
- ✅ **BLOG詳細** (`/blog/[id]`)
  - 共通レイアウトコンポーネント使用
  - パンくずリスト
  - 関連コンテンツ表示

### 認証関連ページ（2025-08-18修正）
- ✅ **ログインページ** (`/login`)
  - サンプルHTMLと同じデザインに修正
  - パスワード表示/非表示トグル機能
  - 日本語エラーメッセージ
  
- ✅ **会員登録情報ページ** (`/signup`)
  - サービス説明ページ（認証フォームではない）
  - SERVICEアイコン（RADIO、Blog）
  - 会費・推奨環境表示
  - 「登録手続きに進む」ボタン→`/register`へ遷移
  
- ✅ **アカウント作成ページ** (`/register`)
  - 実際の新規登録フォーム
  - Firebase Authentication連携
  - メールアドレス・パスワード・表示名入力

### その他のページ
- ✅ **お問い合わせページ** (`/contact`)
  - 独立したレイアウト（共通コンポーネント不使用）
  - お問い合わせ種別選択
  - フォームバリデーション

### 共通コンポーネント
- ✅ **Header** - ナビゲーション、スクロール時の影表示
- ✅ **Footer** - SNSリンク、サポートリンク
- ✅ **ViewAllLayout** - 一覧ページ用共通レイアウト
- ✅ **DetailLayout** - 詳細ページ用共通レイアウト